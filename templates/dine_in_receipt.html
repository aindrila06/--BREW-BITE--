<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Receipt - Brew & Bite</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">
  <style>
      body { font-family: 'Plus Jakarta Sans', sans-serif; }
      @media print {
          body * { visibility: hidden; }
          #receipt-container, #receipt-container * { visibility: visible; }
          #receipt-container { position: absolute; left: 0; top: 0; width: 100%; }
          .no-print { display: none; }
      }
  </style>
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen p-6">

  <div class="w-full max-w-md bg-white shadow-lg rounded-lg">
    <div id="receipt-container" class="p-8">
        <div class="text-center mb-8">
            <h1 class="text-2xl font-bold">BREW & BITE</h1>
            <p class="text-gray-500">Tax Invoice</p>
        </div>
        
        <div class="flex justify-between text-sm text-gray-600 mb-4">
            <div>
                <p><strong>Order ID:</strong> <span id="order-id"></span></p>
                <p><strong>Table No:</strong> <span id="table-number"></span></p>
            </div>
            <div>
                <p><strong>Date:</strong> <span id="order-date"></span></p>
                <p><strong>Booking ID:</strong> <span id="booking-id">BNB-1234</span></p> <!-- Placeholder -->
            </div>
        </div>

        <table class="w-full text-left mb-8">
            <thead>
                <tr class="border-b-2 border-dashed">
                    <th class="py-2 font-bold">ITEM</th>
                    <th class="py-2 font-bold text-center">QTY</th>
                    <th class="py-2 font-bold text-right">PRICE</th>
                </tr>
            </thead>
            <tbody id="receipt-items">
                <!-- Items will be loaded here -->
            </tbody>
            <tfoot class="border-t-2 border-dashed">
                <tr>
                    <td colspan="2" class="py-2 font-medium text-right">Subtotal</td>
                    <td id="receipt-subtotal" class="py-2 font-medium text-right">₹0</td>
                </tr>
                <tr>
                    <td colspan="2" class="py-2 font-medium text-right">GST (18%)</td>
                    <td id="receipt-gst" class="py-2 font-medium text-right">₹0</td>
                </tr>
                <tr>
                    <td colspan="2" class="py-2 font-bold text-2xl text-right">TOTAL</td>
                    <td id="receipt-total" class="py-2 font-bold text-2xl text-right">₹0</td>
                </tr>
            </tfoot>
        </table>

        <p class="text-center text-gray-500 text-sm">Thank you for dining with us!</p>
    </div>
    <div class="p-6 bg-gray-50 rounded-b-lg no-print">
        <button id="print-button" onclick="window.print()" class="w-full bg-[#009963] text-white font-bold py-3 rounded-lg hover:bg-[#007a50] transition mb-3">
            Print Receipt
        </button>
        <a href="{{ url_for('logout') }}" class="w-full block text-center bg-gray-600 text-white font-bold py-3 rounded-lg hover:bg-gray-700 transition">
            Logout & Return Home
        </a>
    </div>
  </div>

  <script>
      document.addEventListener('DOMContentLoaded', () => {
          const orderDetails = JSON.parse(sessionStorage.getItem('confirmedOrder'));

          if (!orderDetails) {
              document.getElementById('receipt-container').innerHTML = '<p class="text-center text-red-500">Could not load receipt details. Please go back.</p>';
              return;
          }

          const orderDate = new Date(orderDetails.timestamp.replace(/, /g, ' '));
          
          document.getElementById('order-id').textContent = orderDetails.order_id;
          document.getElementById('table-number').textContent = orderDetails.table_number;
          document.getElementById('order-date').textContent = orderDate.toLocaleDateString();

          const itemsContainer = document.getElementById('receipt-items');
          itemsContainer.innerHTML = orderDetails.items.map(item => `
              <tr>
                  <td class="py-2">${item.name}</td>
                  <td class="py-2 text-center">${item.quantity}</td>
                  <td class="py-2 text-right">₹${item.price * item.quantity}</td>
              </tr>
          `).join('');

          document.getElementById('receipt-subtotal').textContent = `₹${orderDetails.subtotal}`;
          document.getElementById('receipt-gst').textContent = `₹${orderDetails.gst}`;
          document.getElementById('receipt-total').textContent = `₹${orderDetails.total}`;
      });
  </script>

</body>
</html>
